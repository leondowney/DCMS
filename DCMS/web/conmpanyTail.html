<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>单位详情</title>
    <link href="js/bstable/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="js/bstable/css/bootstrap-table.css" rel="stylesheet" type="text/css">
    <link href="css/table.css" rel="stylesheet" type="text/css">
    <link href="css/addStyle.css" rel="stylesheet" type="text/css">
    <link href="css/zTreeStyle/zTreeStyle.css" rel="stylesheet" type="text/css" />
    <style>
        .notice_main1{border: none !important;}
        * {
            margin: 0;
            padding: 0;
        }

        ul {
            list-style: none;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f5f5f5;
            min-width: 1100px;
            overflow: auto;
        }

        #box {
            width: 100%;
            height: 100%;
            margin: 0 auto 0;
        }

        #tabs ul {
            height: 31px;
            border-left: #ccc solid 1px;
            border-bottom: #ccc solid 1px;
        }

        #tabs ul li {
            float: left;
            border-top: #ccc solid 1px;
            border-right: #ccc solid 1px;
        }

        #tabs ul li a {
            display: block;
            padding: 0 12px;
            line-height: 29px;
            border: white solid 1px;
            border-bottom: none;
            background-color: #e0e0e0;
            color: #271d1e;
            text-decoration: none;
            font-size: 14px;
        }

        /*当一个标题a获得焦点时的样式*/
        #tabs ul li .current {
            border-bottom: white solid 1px;
            background-color: white;
        }

        #box_main {
            /*border: #ccc solid 1px;*/
            border-top: none;
            width: 100%;
            /*height: 650px;*/
        }

        #box_main h3 {
            line-height: 47px;
            font-size: 22px;
            color: #434142;
            border-bottom: #e2e2e2 dashed 1px;
            margin-bottom: 10px;
        }

        /*让一开始，所有的内容面板隐藏*/
        #box_main > div {

            display: none;

        }

        /*一开始，第一个内容面板显示*/
        #box_main #gallery {
            display: block;
            width: 100%;
            background-color: #ffffff !important;

        }



        #box_main p {
            color: #999999;
            font-size: 12px;
            line-height: 21px;
        }
    </style>
    <script src="js/jquery-2.2.0.min.js"></script>
    <script>
        $(init);
        function init(){
            // 遍历每一个li
            $("#tabs .title").find("li").each(function(index){
                $(this).on("click",function(){
                    $(this).siblings().find("a").removeClass("current");
                    $(this).find("a").addClass("current");
                    $("#box_main>div").eq(index).fadeIn().siblings().stop().hide();
                });
            });
        }
    </script>
</head>

<body onload="tableLoad()">

<div id="box">
    <div id="tabs">
        <ul class="title">
            <li><a href="javascript:void(0)" class="current">基本信息</a></li>
            <li><a href="javascript:void(0)">产品列表</a></li>
            <li><a href="javascript:void(0)">资质列表</a></li>
            <li><a href="javascript:void(0)">营销记录</a></li>
            <li><a href="javascript:void(0)">事故记录</a></li>
        </ul>
    </div>
    <div id="box_main">

<!--        基础信息 lxd-->
        <div class="contact" style="display: block">
            <table class="tailTable" border="1">
                <tr>
                    <td class="Tailtd_label"><label>公司名称</label></td>
                    <td class="TailTableTd" id="name" ></td>
                    <td class="tableImg" rowspan="5" colspan="2"><img src="img/company1.png" /> </td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>工商营业执照编号</label></td>
                    <td class="TailTableTd" id="no"></td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>公司性质</label></td>
                    <td class="TailTableTd" id="types"></td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>经营范围</label></td>
                    <td class="TailTableTd" id="manageRange"></td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>法人代表</label></td>
                    <td class="TailTableTd" id="person"></td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>公司地址</label></td>
                    <td class="TailTableTd" colspan="3" id="companyLocation"></td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>注册时间</label></td>
                    <td class="TailTableTd" colspan="3" id="registTime"></td>

                </tr>
                <tr>
                    <td class="Tailtd_label"><label>人员规模</label></td>
                    <td class="TailTableTd" id="pScale" ></td>
                    <td class="Tailtd_label"><label>主要产品及规模</label></td>
                    <td class="TailTableTd" id="mode" ></td>


                </tr>

                <tr>
                    <td class="Tailtd_label"><label>企业分管安全负责人</label></td>
                    <td class="TailTableTd" id="speople"></td>
                    <td class="Tailtd_label"><label>联系电话</label></td>
                    <td class="TailTableTd" id="sPTel"></td>


                </tr>
                <tr>
                    <td class="Tailtd_label"><label>化工行业分类</label></td>
                    <td class="TailTableTd" id="type" ></td>
                    <td class="Tailtd_label"><label>安全生产标准化等级</label></td>
                    <td class="TailTableTd" id="level"></td>


                </tr>
                <tr>
                    <td class="Tailtd_label"><label>安全生产管理机构名称</label></td>
                    <td class="TailTableTd" id="sDept" ></td>
                    <td class="Tailtd_label"><label>专职安全生产 管理人员人数</label></td>
                    <td class="TailTableTd" id="sMangePeoples" ></td>


                </tr>
                <tr>
                    <td class="Tailtd_label"><label>危险化学品作业人员人数</label></td>
                    <td class="TailTableTd" id="dcPeoples"></td>
                    <td class="Tailtd_label"><label>特种作业人员 人数</label></td>
                    <td class="TailTableTd" id="speJobPeoples" ></td>


                </tr>
                <tr>
                    <td class="Tailtd_label"><label>重点监管的危险化工工艺种数</label></td>
                    <td class="TailTableTd" id="dcTypes"></td>
                    <td class="Tailtd_label"><label>重点监管的危险化工工艺名称</label></td>
                    <td class="TailTableTd" id="dangeDcName"></td>


                </tr>
                <tr>
                    <td class="Tailtd_label"><label>危险化学品库房或仓储 场所建筑面积（平方米）</label></td>
                    <td class="TailTableTd" id="dangeDcRange"></td>
                    <td class="Tailtd_label"><label>储罐（容器）总容积（立方米）</label></td>
                    <td class="TailTableTd" id="storageCapacity"></td>


                </tr>



                <tr>
                    <td class="Tailtd_label"><label>厂区边界外 1000米范围内的单位或设施情况</label></td>
                    <td class="TailTableTd" colspan="3" id="boundary"></td>

                </tr>
            </table>

        </div>
<!--        产品列表 lxd-->
        <div class="contact">
            <div class="notice_check">
                <p>
                    <label class="">产品批次：</label>
                    <input type="text" id="id" class="find_input" placeholder="">
                    <label class="">产品名称：</label>
                    <input type="text" id="proName" class="find_input" placeholder="">
                    <label class="">生产日期：</label>
                    <input type="date" id="proTime" class="find_input"  placeholder="">
                    <button class="check_btn" onclick="StorySearch()">查询</button>

                </p>
            </div>
            <table id="table"></table>

        </div>
<!--        资质证书 ly-->
        <div class="contact">
            <div class="lawLeft01">
                <h6>资质列表</h6>
                <ul class="companyListUl">
                </ul>
            </div>

            <div class="lawLeft03">
                <h6>资质证书查看</h6>
                <div id="imgDiv">
                </div>
            </div>

        </div>
<!--        营销记录 ly-->
        <div class="contact">
            <div class="notice_check">
                <p>
                    <label class="">合同号：</label>
                    <input type="text" id="d1" class="find_input" placeholder="">
                    <label class="">合同名称：</label>
                    <input type="text" id="d2" class="find_input" placeholder="">
                    <label class="">销售日期：</label>
                    <input type="date" id="d3" class="find_input" placeholder="">
                    <button class="check_btn" onclick="recordSearch()">查询</button>

                </p>
            </div>
            <table id="table1"></table>

        </div>
<!--        事故记录 ljt-->
        <div class="contact">
            <div class="notice_check">
                <p>
                    <label class="">事故名称：</label>
                    <input type="text" class="find_input" id="aname" placeholder="">
                    <label class="">级别：</label>
                   <select class="find_input" id="alevel">
                       <option value="">全部</option>
                       <option>特大</option>
                       <option>极大</option>
                       <option>重大</option>
                       <option>一般</option>
                   </select>
                    <label class="">发生日期：</label>
                    <input type="date" class="find_input" id="atime"  placeholder="">
                    <button class="check_btn" onclick="acSearch()">查询</button>

                </p>
            </div>
            <table id="table2"></table>

        </div>
    </div>
</div>

</body>
<script src="js/jquery/jQuery-2.2.0.min.js"></script>
<script src="js/bstable/js/bootstrap.min.js"></script>
<script src="js/bstable/js/bootstrap-table.js"></script>
<script src="js/bstable/js/bootstrap-table-zh-CN.min.js"></script>
<script src="js/layer_v2.1/layer/layer.js"></script>
<script type="text/javascript" src="js/demo/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="js/ztree/jquery.ztree.excheck-3.5.js"></script>
<script type="text/javascript" src="js/ztree/jquery.ztree.exedit-3.5.js"></script>
<script type="text/javascript">
    var url =  window.location.search;
    var s = url.split("?")[1].split("=")[1];

    $(function () {


        //单位基本信息获取 lxd
        $.ajax({
            url: "company/companyBasic/getOneById",
            type: "post",
            data: {id : s},
            success: function (ss){
                var res = JSON.parse(ss);
                var data = res.data;
                $("#name").text(data.name);
                $("#no").text(data.no);
                $("#types").text(data.type);
                $("#manageRange").text(data.manageRange);
                $("#person").text(data.person);
                $("#companyLocation").text(data.companyLocation);
                $("#registTime").text(data.registTime);
                $("#pScale").text(data.pScale);
                $("#mode").text(data.mode);
                $("#speople").text(data.speople);
                $("#sPTel").text(data.sPTel);
                $("#type").text(data.type01);
                $("#level").text(data.level);
                $("#sDept").text(data.sDept);
                $("#sMangePeoples").text(data.sMangePeoples);
                $("#dcPeoples").text(data.dcPeoples);
                $("#speJobPeoples").text(data.speJobPeoples);
                $("#dcTypes").text(data.dcTypes);
                $("#dangeDcName").text(data.dangeDcName);
                $("#dangeDcRange").text(data.dangeDcRange);
                $("#storageCapacity").text(data.storageCapacity);
                $("#boundary").text(data.boundary);


            }
        });

        $(".companyListUl li a").click(function () {
            $(this).addClass("conpanyListActive").parents().siblings().find("a").removeClass("conpanyListActive");

        })

        //产品列表数据获取 lxd
        $('#table').bootstrapTable({
            method: "post",
            striped: true,
            singleSelect: false,
            url: "company/companyStory/getAll",
            dataType: "json",
            pagination: true, //分页
            pageSize: 10,
            pageNumber: 1,
            search: false, //显示搜索框
            contentType: "application/x-www-form-urlencoded",
            queryParams:{id:"",proName:"",proTime:"",companyId:s},
            columns: [

                {
                    title: "产品批次",
                    field: 'id',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '产品名称',
                    field: 'proName',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '产品类型',
                    field: 'proType',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '别名',
                    field: 'anotherName',
                    align: 'center'
                },
                {
                    title: '分子式',
                    field: 'molecule',
                    align: 'center'
                },

                {
                    title: '数量',
                    field: 'nums',
                    align: 'center'
                }
            ]
        });

        //资质证书数据获取 ly
        $.ajax({
            url: "company/record/getone",
            data: {cid:s},
            type: "post",
            success: function (res) {
                var ss = JSON.parse(res);
                var data = ss.data;

                for (var i = 0 ; i < data.length ; i++) {
                    if (i == 0) {
                        var li = "<li style='font-weight: bold'><a href='#' onclick='change("+i+")'>"+data[i].name+"</a><span>"+data[i].date+"</span></li>"
                    }else{
                        var li = "<li><a href='#' onclick='change("+i+")'>"+data[i].name+"</a><span>"+data[i].date+"</span></li>"
                    }


                    $(".companyListUl").append(li);

                    var img = "<p class='lawLeft03p01'><img src='img/"+data[i].url+"' class='companyImg'/></p>";
                    $("#imgDiv").append(img);
                }
                var cd = $("#imgDiv").children();

                for (var i =0; i < cd.length;i++) {
                    if(i != 0) {
                        cd[i].style.display='none';
                    }
                }
            }
        })

        //营销记录数据获取 ly
        $('#table1').bootstrapTable({
            method: "post",
            striped: true,
            singleSelect: false,
            url: "company/record/getAll",
            dataType: "json",
            pagination: false, //分页
            pageSize: 10,
            pageNumber: 1,
            search: false, //显示搜索框
            contentType: "application/x-www-form-urlencoded",
            queryParams: {htmc:"", hth:"", htrq:"", cid:s},
            columns: [

                {
                    title: "合同编号",
                    field: 'no',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '合同名称',
                    field: 'name',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '销售物品',
                    field: 'goods',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '销售数量',
                    field: 'num',
                    align: 'center'
                },
                {
                    title: '购方单位',
                    field: 'unit',
                    align: 'center'
                },
                {
                    title: '联系电话',
                    field: 'tele',
                    align: 'center'
                },
                {
                    title: '经办人',
                    field: 'person',
                    align: 'center'
                },
                {
                    title: '销售时间',
                    field: 'time',
                    align: 'center'
                }

            ]
        });

        // 事故记录数据获取 ljt
        $('#table2').bootstrapTable({
            method: "post",
            striped: true,
            singleSelect: false,
            url: "company/accident/getAll",
            dataType: "json",
            pagination: false, //分页
            pageSize: 10,
            pageNumber: 1,
            search: false, //显示搜索框
            contentType: "application/x-www-form-urlencoded",
            queryParams:{name:"",level:"",time:"",cid:s},
            columns: [

                {
                    title: "编号",
                    field: 'no',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '事故名称',
                    field: 'name',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '事故类型',
                    field: 'type',
                    align: 'center',
                    valign: 'middle'
                },
                {
                    title: '发生时间',
                    field: 'time',
                    align: 'center'
                },
                {
                    title: '危险级别',
                    field: 'level',
                    align: 'center'
                },
                {
                    title: '伤亡人数',
                    field: 'num',
                    align: 'center'
                },
                {
                    title: '财产损失',
                    field: 'lost',
                    align: 'center'
                },
                {
                    title: '责任人',
                    field: 'person01',
                    align: 'center'
                },
                {
                    title: '处理单位',
                    field: 'person',
                    align: 'center'
                },

                {
                    title: '处罚方式',
                    field: 'type01',
                    align: 'center'
                }
            ]
        });
    });

    //产品列表数据搜索 lxd
    function StorySearch(){
        var id =  $("#id").val();
        var proName = $("#proName").val();
        var proTime = $("#proTime").val();

        $.ajax({
            url:"company/companyStory/getAll",
            type:"post",
            data:{id:id,proName:proName,proTime:proTime,companyId:s},
            success: function (res){
                var result = JSON.parse(res);
                $('#table').bootstrapTable('load',result.data);
            }
        })
    }

    //事故列表数据搜索 ljt
    function acSearch(){

        var name = $("#aname").val();
        var level = $("#alevel").val();
        var time = $("#atime").val();

        $.ajax({
            url: "company/accident/getAll",
            type: "post",
            data:{name:name,level:level,time:time,cid:s},
            success:function (res){
                var parse = JSON.parse(res);
                $('#table2').bootstrapTable('load',parse.data);
            }
        });
    }

    //资质证书切换显示 ly
    function change(id) {
        var cd = $("#imgDiv").children();
        var li = $(".companyListUl").children();

        for (var i =0; i < cd.length;i++) {
            if(i != id) {
                li[i].style.fontWeight='normal';
                cd[i].style.display='none';
            }else {
                li[i].style.fontWeight='bold';
                cd[i].style.display='block';
            }
        }
    }

    //营销记录数据搜索 ly
    function recordSearch() {
        var hth = $("#d1").val();
        var htmc = $("#d2").val();
        var htrq = $("#d3").val();


        $.ajax({
            url: "company/record/getAll",
            data: {hth: hth, htmc: htmc, htrq: htrq, cid:s},
            type: "post",
            success: function (res) {
                var ss = JSON.parse(res);
                $("#table1").bootstrapTable("load",ss.data);
            }


        })


    }
</script>


</html>
